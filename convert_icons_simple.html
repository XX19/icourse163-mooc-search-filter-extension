<!DOCTYPE html>
<html>
<head>
    <title>SVG to PNG - Simple</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .icon-section { margin: 20px 0; padding: 20px; border: 1px solid #ccc; }
        canvas { border: 1px solid #ddd; margin: 10px; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .status { color: #666; font-style: italic; }
    </style>
</head>
<body>
    <h1>🎨 MOOC 图标转换工具</h1>
    <p class="status">正在加载图标文件...</p>
    
    <div class="icon-section">
        <h3>16x16 图标</h3>
        <canvas id="canvas16" width="16" height="16"></canvas>
        <br>
        <button onclick="convertIcon('icon16.svg', 16, 'canvas16')">转换 16x16</button>
        <button onclick="downloadCanvas('canvas16', 'icon16.png')">下载 PNG</button>
        <div id="status16" class="status"></div>
    </div>
    
    <div class="icon-section">
        <h3>48x48 图标</h3>
        <canvas id="canvas48" width="48" height="48"></canvas>
        <br>
        <button onclick="convertIcon('icon48.svg', 48, 'canvas48')">转换 48x48</button>
        <button onclick="downloadCanvas('canvas48', 'icon48.png')">下载 PNG</button>
        <div id="status48" class="status"></div>
    </div>
    
    <div class="icon-section">
        <h3>128x128 图标</h3>
        <canvas id="canvas128" width="128" height="128"></canvas>
        <br>
        <button onclick="convertIcon('icon128.svg', 128, 'canvas128')">转换 128x128</button>
        <button onclick="downloadCanvas('canvas128', 'icon128.png')">下载 PNG</button>
        <div id="status48" class="status"></div>
    </div>

    <script>
        async function convertIcon(svgFile, size, canvasId) {
            const statusId = 'status' + size;
            const statusEl = document.getElementById(statusId);
            
            try {
                statusEl.textContent = '正在转换...';
                
                const response = await fetch(svgFile);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const svgText = await response.text();
                console.log(`SVG content for ${svgFile}:`, svgText);
                
                const img = new Image();
                const svg = new Blob([svgText], {type: 'image/svg+xml'});
                const url = URL.createObjectURL(svg);
                
                img.onload = function() {
                    const canvas = document.getElementById(canvasId);
                    const ctx = canvas.getContext('2d');
                    ctx.clearRect(0, 0, size, size);
                    ctx.drawImage(img, 0, 0, size, size);
                    URL.revokeObjectURL(url);
                    
                    statusEl.textContent = `✅ 转换完成 (${size}x${size})`;
                    console.log(`Successfully converted ${svgFile} to ${size}x${size}`);
                };
                
                img.onerror = function() {
                    statusEl.textContent = `❌ 图片加载失败`;
                    console.error('Image load error for:', svgFile);
                };
                
                img.src = url;
                
            } catch (error) {
                statusEl.textContent = `❌ 错误: ${error.message}`;
                console.error('Error converting icon:', error);
            }
        }
        
        function downloadCanvas(canvasId, filename) {
            const canvas = document.getElementById(canvasId);
            const link = document.createElement('a');
            link.download = filename;
            link.href = canvas.toDataURL('image/png');
            link.click();
            console.log(`Downloaded: ${filename}`);
        }
        
        // 页面加载完成后自动转换所有图标
        window.onload = function() {
            document.querySelector('.status').textContent = '页面加载完成，可以开始转换图标';
            
            // 延迟转换，确保页面完全加载
            setTimeout(() => {
                convertIcon('icon16.svg', 16, 'canvas16');
                convertIcon('icon48.svg', 48, 'canvas48');
                convertIcon('icon128.svg', 128, 'canvas128');
            }, 1000);
        };
    </script>
</body>
</html>
